<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í°ìˆ˜í•™ìŠµ í™ˆí˜ì´ì§€</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
        <div class="container">
        <div class="header-section">
            <h1>í°ìˆ˜í•™ìŠµ í™ˆí˜ì´ì§€</h1>
            <div id="studentInfo" class="student-info" style="display: none;">
                <span id="studentDetails"></span>
                <button id="changeStudentBtn" class="btn-small">í•™ìƒ ë³€ê²½</button>
            </div>
        </div>
        
        <div class="main-menu">
            <h2>í°ìˆ˜ë¥¼ ì•Œì•„ë³´ê¸°</h2>
            <p class="description">ì•„ë˜ í•™ìŠµ ë‹¨ê³„ë¥¼ ìˆœì„œëŒ€ë¡œ ì§„í–‰í•´ë³´ì„¸ìš”!</p>
            
            <div class="page-grid">
                <a href="page1.html" class="page-card">
                    <div class="page-number">1</div>
                    <h3>ë§Œì„ ì•Œì•„ë³´ê¸°</h3>
                    <p>1000ì´ 10ê°œì¸ ìˆ˜ëŠ” 10000 ì´ëŠ” 1ë§Œì´ë¼ê³  í•©ë‹ˆë‹¤</p>
                </a>
                
                <a href="page2.html" class="page-card">
                    <div class="page-number">2</div>
                    <h3>ë‹¤ì„¯ ìë¦¬ ìˆ˜ë¥¼ ì•Œì•„ë³´ê¸°</h3>
                    <p>46571 -> 4ë§Œ 6ì²œ 5ë°± 7ì‹­ 1</p>
                </a>
                
                <a href="page3.html" class="page-card">
                    <div class="page-number">3</div>
                    <h3>ì‹­ë§Œ, ë°±ë§Œ, ì²œë§Œì„ ì•Œì•„ë³´ê¸°</h3>
                    <p>1ë§Œ -> 10ë§Œ -> 100ë§Œ -> 1000ë§Œ</p>
                </a>
                
                <a href="page4.html" class="page-card">
                    <div class="page-number">4</div>
                    <h3>ì–µì„ ì•Œì•„ë³´ê¸°</h3>
                    <p>1ì–µì€ 1000ë§Œì´ 10ê°œì¸ ìˆ˜ì—ìš”</p>
                </a>
                
                <a href="page5.html" class="page-card">
                    <div class="page-number">5</div>
                    <h3>ì¡°ë¥¼ ì•Œì•„ë³´ê¸°</h3>
                    <p>1ì¡°ëŠ” 1000ì–µì´ 10ê°œì¸ ìˆ˜ì—ìš”</p>
                </a>
                
                <a href="page6.html" class="page-card">
                    <div class="page-number">6</div>
                    <h3>ë›°ì–´ì„¸ê¸°</h3>
                    <p>ë§Œì”© ë›°ì–´ì„¸ê¸°: ë§Œì˜ ìë¦¬ ìˆ«ìê°€ 1ì”© ì»¤ì ¸</p>
                </a>
                
                <a href="page7.html" class="page-card">
                    <div class="page-number">7</div>
                    <h3>ìˆ˜ì˜ í¬ê¸°ë¥¼ ë¹„êµí•˜ê¸°</h3>
                    <p>ë‘ ìˆ˜ì˜ í¬ê¸°ë¥¼ ë¹„êµí•´ë³´ì„¸ìš”</p>
                </a>
                
                <a href="certificate.html" class="page-card certificate-card">
                    <div class="page-number">ì™„ë£Œ</div>
                    <h3>í•™ìŠµ ì™„ë£Œ ì¦ëª…ì„œ</h3>
                    <p>ëª¨ë“  í•™ìŠµì„ ì™„ë£Œí•˜ê³  ì¦ëª…ì„œë¥¼ ë°›ì•„ë³´ì„¸ìš”</p>
                </a>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>ì—°ìŠµ ë¬¸ì œ</h2>
            <div class="problem-section">
                <div class="problem-number">ì—°ìŠµ</div>
                <div class="instruction">ë¹ˆì¹¸ì— ì•Œë§ì€ ìˆ˜ë¥¼ ë„£ì–´ì„¸ìš”</div>

        <div class="math-problem">
          <div class="equation-row">
            <span class="number">9996</span>
            <span class="operator">-</span>
            <span class="number">9997</span>
            <span class="operator">-</span>
            <input
              type="text"
              class="answer-input"
              id="answer1"
              maxlength="4"
             
            />
            <span class="operator">-</span>
            <input
              type="text"
              class="answer-input"
              id="answer2"
              maxlength="4"
             
            />
            <span class="operator">-</span>
            <span class="number">10000</span>
          </div>
        </div>

        <div class="button-container">
          <button id="checkAnswer" class="check-button">ì •ë‹µ í™•ì¸</button>
          <button id="resetAnswer" class="reset-button">ë‹¤ì‹œ í’€ê¸°</button>
        </div>

        <div id="result" class="result-message"></div>
      </div>
    </div>

    <script>
      // ê°„ë‹¨í•œ ì—°ìŠµ ë¬¸ì œ ìŠ¤í¬ë¦½íŠ¸
      document.getElementById('checkAnswer').addEventListener('click', function() {
        const answer1 = document.getElementById('answer1').value;
        const answer2 = document.getElementById('answer2').value;
        const result = document.getElementById('result');
        
        if (answer1 === '9998' && answer2 === '9999') {
          result.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘';
          result.className = 'result-message correct';
        } else {
          result.textContent = 'ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. íŒíŠ¸: 1ì”© ì¦ê°€í•˜ëŠ” ìˆ˜ì—´ì…ë‹ˆë‹¤';
          result.className = 'result-message incorrect';
        }
      });
      
      document.getElementById('resetAnswer').addEventListener('click', function() {
        document.getElementById('answer1').value = '';
        document.getElementById('answer2').value = '';
        document.getElementById('result').textContent = '';
      });
    </script>
    <script src="config.js"></script>
    <script>
      // í˜ì´ì§€ ì ‘ê·¼ ì œí•œ ì ìš©
      document.addEventListener('DOMContentLoaded', async function() {
        console.log("ğŸ  ë©”ì¸ í˜ì´ì§€ ë¡œë“œ ì‹œì‘...");
        
        // ë””ë²„ê¹… ì •ë³´ ì¶œë ¥
        pageConfig.debugStatus();
        
        // í•™ìƒ ì´ˆê¸°í™”
        const isStudentReady = await pageConfig.initStudent();
        
        console.log("ğŸ” í•™ìƒ ì´ˆê¸°í™” ê²°ê³¼:", isStudentReady);
        console.log("ğŸ‘¤ í˜„ì¬ í•™ìƒ ì •ë³´:", pageConfig.currentStudent);
        
        if (isStudentReady && pageConfig.currentStudent) {
          // í•™ìƒ ì •ë³´ í‘œì‹œ
          const studentInfo = document.getElementById('studentInfo');
          const studentDetails = document.getElementById('studentDetails');
          const student = pageConfig.currentStudent;
          
          console.log("âœ… í•™ìƒ ì •ë³´ í‘œì‹œ:", student);
          
          studentDetails.innerHTML = `
            ğŸ‘¨â€ğŸ“ <strong>${student.studentName}</strong> | 
            ğŸ« ${student.schoolName} ${student.grade}í•™ë…„ ${student.classNumber}ë°˜ ${student.studentNumber}ë²ˆ
          `;
          studentInfo.style.display = 'block';
          
          // ì™„ë£Œëœ ë‹¨ê³„ í‘œì‹œ
          const completedCount = student.completedPages ? student.completedPages.length : 0;
          console.log(`ğŸ“Š ì™„ë£Œëœ ë‹¨ê³„: ${completedCount}/7`);
          
          // í•™ìƒ ë³€ê²½ ë²„íŠ¼ ì´ë²¤íŠ¸
          document.getElementById('changeStudentBtn').addEventListener('click', function() {
            if (confirm('ì •ë§ë¡œ í•™ìƒì„ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ì§„ë„ëŠ” ì„œë²„ì— ì €ì¥ë©ë‹ˆë‹¤.')) {
              localStorage.removeItem('studentId');
              localStorage.removeItem('studentInfo');
              window.location.href = 'student-register.html';
            }
          });
        } else {
          console.log("âŒ í•™ìƒ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨");
          
          // localStorage í™•ì¸
          const storedStudentId = localStorage.getItem('studentId');
          const storedStudentInfo = localStorage.getItem('studentInfo');
          
          console.log("ğŸ“± ì €ì¥ëœ studentId:", storedStudentId);
          console.log("ğŸ“± ì €ì¥ëœ studentInfo:", storedStudentInfo);
          
          if (storedStudentId && storedStudentInfo) {
            console.log("ğŸ”„ localStorage ì •ë³´ê°€ ìˆì§€ë§Œ ì„œë²„ ë¡œë“œ ì‹¤íŒ¨ - ì¬ì‹œë„ ì¤‘...");
            
            // 3ì´ˆ í›„ ì¬ì‹œë„
            setTimeout(async () => {
              console.log("ğŸ”„ í•™ìƒ ì •ë³´ ì¬ë¡œë“œ ì‹œë„...");
              const retryResult = await pageConfig.initStudent();
              
              if (retryResult && pageConfig.currentStudent) {
                console.log("âœ… ì¬ì‹œë„ ì„±ê³µ!");
                window.location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
              } else {
                console.log("âŒ ì¬ì‹œë„ë„ ì‹¤íŒ¨ - ë“±ë¡ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸");
                alert("í•™ìƒ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë“±ë¡í•´ì£¼ì„¸ìš”.");
                window.location.href = 'student-register.html';
              }
            }, 3000);
          }
        }
        
        // í˜ì´ì§€ ì ‘ê·¼ ê¶Œí•œ ë° ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updatePageStatus() {
          const completed = pageConfig.getCompletedPages();
          const pageCards = document.querySelectorAll('.page-card');
          
          pageCards.forEach((card, index) => {
            const pageId = index + 1;
            const href = card.getAttribute('href');
            
            // ê¸°ì¡´ ì²´í¬ë§ˆí¬ ì œê±°
            const existingCheck = card.querySelector('.completion-check');
            if (existingCheck) {
              existingCheck.remove();
            }
            
            if (href === 'certificate.html') {
              // ì¦ëª…ì„œëŠ” ëª¨ë“  7ë‹¨ê³„ ì™„ë£Œ í›„ ì ‘ê·¼ ê°€ëŠ¥
              if (!pageConfig.isCertificateAccessible()) {
                card.style.opacity = '0.5';
                card.style.pointerEvents = 'none';
                card.addEventListener('click', function(e) {
                  e.preventDefault();
                  const completedCount = pageConfig.getCompletedPages().length;
                  alert(`ì•„ì§ í•™ìŠµì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nì™„ë£Œ: ${completedCount}/7ë‹¨ê³„\nëª¨ë“  7ë‹¨ê³„ë¥¼ ì™„ë£Œí•´ì•¼ ì¦ëª…ì„œë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!`);
                });
              } else {
                card.style.opacity = '1';
                card.style.pointerEvents = 'auto';
              }
            } else if (pageId > 1) {
              // 2ë‹¨ê³„ë¶€í„°ëŠ” ì´ì „ ë‹¨ê³„ ì™„ë£Œ í›„ ì ‘ê·¼ ê°€ëŠ¥
              if (!pageConfig.isPageAccessible(pageId)) {
                card.style.opacity = '0.5';
                card.style.pointerEvents = 'none';
                card.addEventListener('click', function(e) {
                  e.preventDefault();
                  alert(`${pageId - 1}ë‹¨ê³„ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”!`);
                });
              } else {
                card.style.opacity = '1';
                card.style.pointerEvents = 'auto';
              }
            }
            
            // ì™„ë£Œëœ í˜ì´ì§€ì— ì²´í¬ í‘œì‹œ
            if (completed.includes(pageId)) {
              const checkMark = document.createElement('div');
              checkMark.innerHTML = 'âœ…';
              checkMark.className = 'completion-check';
              checkMark.style.position = 'absolute';
              checkMark.style.top = '10px';
              checkMark.style.right = '10px';
              checkMark.style.fontSize = '1.5em';
              checkMark.style.zIndex = '10';
              card.style.position = 'relative';
              card.appendChild(checkMark);
            }
          });
        }
        
        // ì´ˆê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
        updatePageStatus();
        
        // í˜ì´ì§€ê°€ í¬ì»¤ìŠ¤ë¥¼ ë°›ì„ ë•Œë§ˆë‹¤ ìƒíƒœ ì—…ë°ì´íŠ¸ (ë‹¤ë¥¸ íƒ­ì—ì„œ ëŒì•„ì˜¬ ë•Œ)
        window.addEventListener('focus', function() {
          console.log("ğŸ”„ í˜ì´ì§€ í¬ì»¤ìŠ¤ - ìƒíƒœ ì—…ë°ì´íŠ¸");
          updatePageStatus();
        });
        
        // ì£¼ê¸°ì ìœ¼ë¡œ ìƒíƒœ ì—…ë°ì´íŠ¸ (10ì´ˆë§ˆë‹¤) 
        setInterval(() => {
          console.log("ğŸ”„ ì£¼ê¸°ì  ìƒíƒœ ì—…ë°ì´íŠ¸");
          updatePageStatus();
        }, 10000);
        
        // ì¶”ê°€ ë””ë²„ê¹… ë²„íŠ¼ (ê°œë°œìš©)
        const debugButton = document.createElement('button');
        debugButton.textContent = 'ğŸ” ë””ë²„ê¹… ì •ë³´';
        debugButton.style.position = 'fixed';
        debugButton.style.bottom = '20px';
        debugButton.style.right = '20px';
        debugButton.style.zIndex = '1000';
        debugButton.style.padding = '10px';
        debugButton.style.backgroundColor = '#007bff';
        debugButton.style.color = 'white';
        debugButton.style.border = 'none';
        debugButton.style.borderRadius = '5px';
        debugButton.style.cursor = 'pointer';
        
        debugButton.addEventListener('click', function() {
          console.log("ğŸ” === ìˆ˜ë™ ë””ë²„ê¹… ì •ë³´ ===");
          pageConfig.debugStatus();
          console.log("ğŸŒ ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...");
          
          // ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸
          fetch('/api/progress/test', {
            method: 'GET',
          }).then(response => {
            console.log("ğŸŒ ì„œë²„ ì‘ë‹µ ìƒíƒœ:", response.status);
            return response.json();
          }).then(data => {
            console.log("ğŸŒ ì„œë²„ ì‘ë‹µ:", data);
          }).catch(error => {
            console.error("âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜:", error);
          });
        });
        
        document.body.appendChild(debugButton);
      });
    </script>
  </body>
</html>
